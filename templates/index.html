<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web爬虫管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .nav-link {
            color: rgba(255, 255, 255, 0.8) !important;
            transition: all 0.3s ease;
        }
        .nav-link:hover, .nav-link.active {
            color: white !important;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: 1px solid #dee2e6;
        }
        .progress {
            height: 1.5rem;
        }
        .status-badge {
            font-size: 0.875rem;
        }
        .log-container {
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .config-section {
            border-left: 4px solid #007bff;
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }
        .forum-item {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        .table-responsive {
            border-radius: 0.375rem;
        }
        .navbar-brand {
            font-weight: 600;
        }
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
            border-radius: 0.25rem;
        }
        .tab-content {
            padding-top: 1rem;
        }
        .form-label {
            font-weight: 500;
        }
        .btn {
            border-radius: 0.25rem;
        }
        .alert {
            border: none;
            border-radius: 0.5rem;
        }
        .table {
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .table th {
            background-color: #f8f9fa;
            border-top: none;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        .log-info { color: #0066cc; }
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-error { color: #dc3545; }
        .log-debug { color: #6c757d; }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-running { background-color: #28a745; }
        .status-stopped { background-color: #dc3545; }
        .status-unknown { background-color: #6c757d; }
        .form-text {
            font-size: 0.875em;
            color: #6c757d;
        }
        .btn-group .btn {
            margin-right: 0.5rem;
        }
        .btn-group .btn:last-child {
            margin-right: 0;
        }
        .text-truncate {
            max-width: 200px;
        }
        .badge {
            font-size: 0.75em;
        }
        .modal-header {
            background-color: #007bff;
            color: white;
        }
        .modal-header .btn-close {
            filter: invert(1);
        }
        .folder-tree {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 10px;
        }
        .folder-item {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 0.25rem;
            margin: 2px 0;
        }
        .folder-item:hover {
            background-color: #e9ecef;
        }
        .folder-item.selected {
            background-color: #007bff;
            color: white;
        }
        .folder-item .folder-name {
            margin-left: 5px;
        }
        .folder-item .folder-id {
            font-size: 0.8em;
            color: #6c757d;
            margin-left: 10px;
        }
        .folder-item.selected .folder-id {
            color: #cce7ff;
        }
        .qr-code-container {
            text-align: center;
            padding: 20px;
        }
        .qr-code-container img {
            max-width: 200px;
            height: auto;
        }
        .countdown {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
        }
        .magnet-input {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .progress-container {
            margin: 10px 0;
        }
        .btn-group-custom {
            gap: 0.5rem;
        }
        .btn-group-custom .btn {
            margin-right: 0;
        }
        .folder-select {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white"><i class="bi bi-robot"></i> 爬虫系统</h4>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-tab="dashboard">
                                <i class="bi bi-speedometer2"></i> 仪表板
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="config">
                                <i class="bi bi-gear"></i> 配置管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="pan115">
                                <i class="bi bi-cloud-upload"></i> 网盘配置
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="results">
                                <i class="bi bi-file-earmark-text"></i> 结果管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="logs">
                                <i class="bi bi-journal-text"></i> 日志查看
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="system">
                                <i class="bi bi-cpu"></i> 系统信息
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主内容区域 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- 顶部导航 -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="page-title">仪表板</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshData()">
                                <i class="bi bi-arrow-clockwise"></i> 刷新
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 仪表板 -->
                <div id="dashboard-tab" class="tab-content">
                    <div class="row">
                        <div class="col-md-3 mb-4">
                            <div class="card text-white bg-primary">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title" id="total-tasks">0</h4>
                                            <p class="card-text">总任务数</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-list-task fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card text-white bg-success">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title" id="success-tasks">0</h4>
                                            <p class="card-text">成功任务</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-check-circle fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card text-white bg-warning">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title" id="running-tasks">0</h4>
                                            <p class="card-text">运行中任务</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-play-circle fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card text-white bg-danger">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 class="card-title" id="failed-tasks">0</h4>
                                            <p class="card-text">失败任务</p>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-x-circle fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">快速操作</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" onclick="app.startQuickCrawl('update_magnets')">
                                            <i class="bi bi-play"></i> 增量爬取
                                        </button>
                                        <button class="btn btn-success" onclick="app.startQuickCrawl('crawl_magnets')">
                                            <i class="bi bi-download"></i> 全量爬取
                                        </button>
                                        <button class="btn btn-info" onclick="app.startQuickCrawl('crawl_tids')">
                                            <i class="bi bi-list"></i> 爬取TID
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0">任务列表</h5>
                                    <button class="btn btn-sm btn-outline-primary" onclick="app.loadAllTasks()">
                                        <i class="bi bi-arrow-clockwise"></i> 刷新
                                    </button>
                                </div>
                                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                    <div id="tasks-list">
                                        <div class="text-center text-muted py-3">正在加载任务列表...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 配置管理 -->
                <div id="config-tab" class="tab-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">爬虫配置</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary" onclick="loadConfig()">
                                    <i class="bi bi-arrow-clockwise"></i> 重新加载
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="saveConfig()">
                                    <i class="bi bi-save"></i> 保存配置
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <form id="config-form">
                                <!-- 基本配置 -->
                                <div class="config-section">
                                    <h6 class="text-primary">基本配置</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">网站基础URL</label>
                                                <input type="url" class="form-control" name="base_url" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">用户代理</label>
                                                <select class="form-select" name="user_agent" id="user-agent-select">
                                                    <option value="">选择用户代理...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">工作线程数</label>
                                                <input type="number" class="form-control" name="worker_count" min="1" max="10">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">最小等待时间(秒)</label>
                                                <input type="number" class="form-control" name="min_wait_time" min="1">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">随机延迟(秒)</label>
                                                <input type="number" class="form-control" name="random_delay" min="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label class="form-label">代理设置 <small class="text-muted">(可选)</small></label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" name="proxy" id="proxy-input" placeholder="http://127.0.0.1:7890">
                                                    <button class="btn btn-outline-secondary" type="button" id="test-proxy-btn" onclick="testProxy()">
                                                        <i class="bi bi-wifi"></i> 测试连通性
                                                    </button>
                                                </div>
                                                <div class="form-text">支持 HTTP/HTTPS/SOCKS5 代理，格式: http://127.0.0.1:7890</div>
                                                <div id="proxy-test-result" class="mt-2" style="display: none;"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="headless">
                                                <label class="form-check-label">无头模式</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="debug">
                                                <label class="form-check-label">调试模式</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">当前最大TID <small class="text-muted">(只读)</small></label>
                                                <input type="text" class="form-control" id="max-tid-display" readonly style="background-color: #f8f9fa;">
                                                <div class="form-text">显示增量爬取的基准TID值</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 论坛配置 -->
                                <div class="config-section">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="text-primary mb-0">论坛配置</h6>
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="addForum()">
                                            <i class="bi bi-plus"></i> 添加论坛
                                        </button>
                                    </div>
                                    <div id="forums-container">
                                        <!-- 论坛配置项将在这里动态生成 -->
                                    </div>
                                </div>

                                <!-- 调度配置 -->
                                <div class="config-section">
                                    <h6 class="text-primary">定时调度</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="schedule_enabled">
                                                <label class="form-check-label">启用定时调度</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">调度模式</label>
                                                <select class="form-select" name="schedule_mode">
                                                    <option value="update_magnets">增量爬取</option>
                                                    <option value="crawl_magnets">全量爬取</option>
                                                    <option value="crawl_tids">爬取TID</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Cron表达式</label>
                                        <input type="text" class="form-control" name="cron_expression" placeholder="0 */6 * * *">
                                        <div class="form-text">格式: 分 时 日 月 周，例如 "0 */6 * * *" 表示每6小时执行一次</div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 网盘配置 -->
                <div id="pan115-tab" class="tab-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">115网盘配置</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary" onclick="loadPan115Config()">
                                    <i class="bi bi-arrow-clockwise"></i> 重新加载
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="savePan115Config()">
                                    <i class="bi bi-save"></i> 保存配置
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <form id="pan115-config-form">
                                <!-- 基本配置 -->
                                <div class="config-section">
                                    <h6 class="text-primary">基本配置</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">目标文件夹ID</label>
                                                <input type="text" class="form-control" name="target_dir_id" placeholder="115网盘文件夹ID">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">磁力链接列名</label>
                                                <input type="text" class="form-control" name="magnet_column" placeholder="CSV文件中磁力链接的列名">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">请求间隔(秒)</label>
                                                <input type="number" class="form-control" name="request_interval" min="1" value="2">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">批处理大小</label>
                                                <input type="number" class="form-control" name="batch_size" min="1" max="100" value="50">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">去重范围</label>
                                                <select class="form-select" name="deduplication_scope">
                                                    <option value="file">仅文件内去重</option>
                                                    <option value="history">与历史记录去重</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 自动转存配置 -->
                                <div class="config-section">
                                    <h6 class="text-primary">自动转存配置</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="auto_transfer_enabled">
                                                <label class="form-check-label">启用自动转存</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="skip_duplicates">
                                                <label class="form-check-label">跳过重复磁力链接</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="skip_invalid_magnets">
                                                <label class="form-check-label">跳过无效磁力链接</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="use_cache_mode">
                                                <label class="form-check-label">使用缓存模式</label>
                                            </div>
                                        </div>
                                    </div>


                                </div>

                                <!-- 自动移动配置 -->
                                <div class="config-section">
                                    <h6 class="text-primary">自动移动配置</h6>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="auto_move_enabled">
                                                <label class="form-check-label">启用自动移动</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">源文件夹ID</label>
                                                <input type="text" class="form-control" name="auto_move_source_dir_id" placeholder="源文件夹ID">
                                                <div class="form-text">将从此文件夹移动所有文件和子文件夹</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">目标文件夹ID</label>
                                                <input type="text" class="form-control" name="auto_move_target_dir_id" placeholder="目标文件夹ID">
                                                <div class="form-text">文件将移动到此文件夹下</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Cron定时表达式</label>
                                                <input type="text" class="form-control" name="auto_move_cron" placeholder="0 2 * * *" value="0 2 * * *">
                                                <div class="form-text">格式: 分 时 日 月 周 (默认每天凌晨2点)</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="d-grid gap-2 d-md-flex">
                                                <button type="button" class="btn btn-primary" onclick="manualMove()">
                                                    <i class="bi bi-arrow-right-circle"></i> 立即移动
                                                </button>
                                                <div class="form-text mt-2">提示：启用自动移动复选框后，系统将按Cron表达式自动执行移动任务</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 登录配置 -->
                                <div class="config-section">
                                    <h6 class="text-primary">登录配置</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="qr_login_enabled">
                                                <label class="form-check-label">启用二维码登录</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="cookie_auto_refresh">
                                                <label class="form-check-label">自动刷新Cookie</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 操作按钮 -->
                                <div class="config-section">
                                    <h6 class="text-primary">操作</h6>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="d-grid gap-2 d-md-flex">
                                                <button type="button" class="btn btn-info" onclick="checkPan115Login()">
                                                    <i class="bi bi-shield-check"></i> 检查登录状态
                                                </button>
                                                <button type="button" class="btn btn-warning" onclick="showPan115QR()">
                                                    <i class="bi bi-qr-code"></i> 扫码登录
                                                </button>
                                                <button type="button" class="btn btn-success" onclick="getPan115Folders()">
                                                    <i class="bi bi-folder"></i> 获取文件夹列表
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 登录状态显示 -->
                                <div class="config-section">
                                    <h6 class="text-primary">登录状态</h6>
                                    <div id="pan115-login-status">
                                        <p class="text-muted">请点击"检查登录状态"按钮</p>
                                    </div>
                                </div>

                                <!-- 文件夹列表 -->
                                <div class="config-section">
                                    <h6 class="text-primary">文件夹列表</h6>
                                    <div id="pan115-folders-list">
                                        <p class="text-muted">请先登录，然后点击"获取文件夹列表"按钮</p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 结果管理 -->
                <div id="results-tab" class="tab-content" style="display: none;">
                    <!-- 单个CSV文件缓存转存 -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">单个CSV文件缓存转存</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">选择CSV文件</label>
                                        <select class="form-select" id="csv-file-select" onchange="handleCsvFileSelect()">
                                            <option value="" disabled selected>请选择CSV文件...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">批次大小</label>
                                        <input type="number" class="form-control" id="batch-size-input" value="50" min="1" max="100">
                                        <div class="form-text">每批处理的文件数量(1-100)</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">&nbsp;</label>

                                    </div>
                                </div>
                            </div>
                            
                            <!-- 文件信息显示 -->
                            <div id="csv-file-info" style="display: none;">
                                <div class="alert alert-info">
                                    <div id="csv-file-details"></div>
                                </div>
                            </div>
                            
                            <!-- 操作按钮 -->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="d-grid gap-2 d-md-flex">
                                        <button type="button" class="btn btn-success" id="manual-transfer-btn" onclick="startManualTransfer()" disabled>
                                            <i class="bi bi-cloud-upload"></i> 直接转存
                                        </button>
                                        <button type="button" class="btn btn-primary" id="cache-transfer-btn" onclick="startCacheTransfer()" disabled>
                                            <i class="bi bi-layers"></i> 缓存转存
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 缓存管理区域 -->
                            <div id="cache-management" style="display: none;" class="mt-4">
                                <h6 class="text-primary">缓存管理</h6>
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label class="form-label">缓存文件路径</label>
                                            <input type="text" class="form-control" id="cache-file-path" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <div class="d-grid">
                                                <button type="button" class="btn btn-warning" id="process-cache-btn" onclick="processCacheFile()" disabled>
                                                    <i class="bi bi-play"></i> 处理缓存
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="cache-info" style="display: none;">
                                    <div class="alert alert-secondary">
                                        <div id="cache-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 爬取结果列表 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">爬取结果</h5>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadResults()">
                                <i class="bi bi-arrow-clockwise"></i> 刷新
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>文件名</th>
                                            <th>大小</th>
                                            <th>修改时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="results-table-body">
                                        <tr>
                                            <td colspan="4" class="text-center text-muted">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 日志查看 -->
                <div id="logs-tab" class="tab-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">系统日志</h5>
                            <div>
                                <select class="form-select form-select-sm d-inline-block w-auto me-2" id="log-lines">
                                    <option value="50">最近50行</option>
                                    <option value="100" selected>最近100行</option>
                                    <option value="200">最近200行</option>
                                    <option value="500">最近500行</option>
                                </select>
                                <button class="btn btn-sm btn-outline-primary" onclick="loadLogs()">
                                    <i class="bi bi-arrow-clockwise"></i> 刷新
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="log-container p-3" id="log-content">
                                <div class="text-center text-muted">加载中...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统信息 -->
                <div id="system-tab" class="tab-content" style="display: none;">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">系统信息</h5>
                                </div>
                                <div class="card-body" id="system-info">
                                    <div class="text-center text-muted">加载中...</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">资源使用情况</h5>
                                </div>
                                <div class="card-body" id="resource-info">
                                    <div class="text-center text-muted">加载中...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 模态框 -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">文件预览</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-sm" id="preview-table">
                            <thead id="preview-thead"></thead>
                            <tbody id="preview-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 115网盘二维码登录模态框 -->
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">115网盘扫码登录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="qr-container">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2">正在获取二维码...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="qr-status" class="text-muted">请使用115手机客户端扫描二维码</div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // 全局函数
        function addForum() {
            app.addForum();
        }

        function removeForum(button) {
            app.removeForum(button);
        }

        function saveConfig() {
            app.saveConfig();
        }

        function testProxy() {
            app.testProxy();
        }

        function startCrawl() {
            app.startCrawl();
        }

        function startQuickCrawl(mode) {
            app.startQuickCrawl(mode);
        }

        function stopCrawl() {
            app.stopCrawl();
        }

        function loadResults() {
            app.loadResults();
        }

        function downloadResult(filename) {
            app.downloadResult(filename);
        }

        function previewResult(filename) {
            app.previewResult(filename);
        }

        function loadLogs() {
            app.loadLogs();
        }

        function loadSystemInfo() {
            app.loadSystemInfo();
        }

        function refreshData() {
            app.refreshData();
        }

        function loadConfig() {
            app.loadConfig();
        }

        // 115网盘配置相关函数
        function loadPan115Config() {
            app.loadPan115Config();
        }

        function savePan115Config() {
            app.savePan115Config();
        }

        function checkPan115Login() {
            app.checkPan115Login();
        }

        function showPan115QR() {
            app.showPan115QR();
        }

        function getPan115Folders() {
            app.getPan115Folders();
        }

        function transferToPan115(filename) {
            app.transferToPan115(filename);
        }

        

        function loadCsvFiles() {
            app.loadCsvFiles();
        }

        // 手动移动相关函数
        function manualMove() {
            app.manualMove();
        }

    </script>
</body>
</html>